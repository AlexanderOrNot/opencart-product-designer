<modification>
	<id>Product Designer</id>
	<version>1.1</version>
	<vqmver>2.4.1</vqmver>
	<author>WeDoWeb.com.au | contact@wedoweb.com.au</author>
	
	<file name="admin/view/template/catalog/product_form.tpl">
		<operation>
			<search position="replace">
				<![CDATA[
					<a href="#tab-design"><?php echo $tab_design; ?></a>
				]]>
			</search>
			<add>
				<![CDATA[
					<a href="#tab-design"><?php echo $tab_design; ?></a><a href="#tab-product-designer"><?php echo $tab_product_designer; ?></a>
				]]>
			</add>
		</operation>
		<operation>
			<search position="after" index="2" offset="8">
				<![CDATA[
					<option value="<?php echo $layout['layout_id']; ?>"><?php echo $layout['name']; ?></option>
				]]>
			</search>
			<add>
				<![CDATA[
					<div id="tab-product-designer">
						<table class="form">
                            <?php foreach ($product_option_designers as $product_option_designer) { ?>
				            <tr>
				              <td><?php echo $text_enable; ?></td>
				              <td>
				              		<input type="radio" name="product_option_designer[0][enable]" value="1" <?php if ($product_option_designer['enable'] == "1") echo "checked='checked'";?>/>
				                	<?php echo $text_yes; ?>
				                	<input type="radio" name="product_option_designer[0][enable]" value="0" <?php if ($product_option_designer['enable'] == "0") echo "checked='checked'";?> />
				                	<?php echo $text_no; ?>
				              </td>
				            </tr>
							<tr>
				              <td><?php echo $text_frame_image; ?></td>
				              <td>
				              		<div class="image"><img src="<?php echo $product_option_designer['thumb']; ?>" alt="" id="thumb_frame_image" />
									  <input type="hidden" name="product_option_designer[0][frame_image]" value="<?php echo $product_option_designer['frame_image']; ?>" id="frame_image" />
									  <br />
									  <a onclick="image_upload('frame_image', 'thumb_frame_image');"><?php echo $text_browse; ?></a>&nbsp;&nbsp;|&nbsp;&nbsp;<a onclick="$('#thumb_frame_image').attr('src', '<?php echo $no_image; ?>'); $('#frame_image').attr('value', '');"><?php echo $text_clear; ?></a>
									</div>
				              </td>
				            </tr>
				            <tr>
				              <td><?php echo $allow_adding_text ?></td>
				              <td>
				              		<input type="radio" name="product_option_designer[0][allow_adding_text]" value="1" <?php if ($product_option_designer['allow_adding_text'] == "1") echo "checked='checked'";?> />
				                	<?php echo $text_yes; ?>
				                	<input type="radio" name="product_option_designer[0][allow_adding_text]" value="0" <?php if ($product_option_designer['allow_adding_text'] == "0") echo "checked='checked'";?>/>
				                	<?php echo $text_no; ?>
				              </td>
				            </tr>
				            <tr>
				              <td><?php echo $allow_text_effects ?></td>
				              <td>
				              		<input type="checkbox" name="product_option_designer[0][allow_text_effect_border]" value="1" <?php if ($product_option_designer['allow_text_effect_border'] == "1") echo "checked='checked'";?> />
				                	<?php echo $text_effects_border ?>
									<br>
				                	<input type="checkbox" name="product_option_designer[0][allow_text_effect_shadow]" value="1" <?php if ($product_option_designer['allow_text_effect_shadow'] == "1") echo "checked='checked'";?> />
				                	<?php echo $text_effects_shadow ?>
									<br>
									<input type="checkbox" name="product_option_designer[0][allow_text_effect_curve]" value="1" <?php if ($product_option_designer['allow_text_effect_curve'] == "1") echo "checked='checked'";?> />
				                	<?php echo $text_effects_curve ?>
				              </td>
				            </tr>
				            <tr>
				              <td><?php echo $text_color ?></td>
				              <td>
				              		<input type="radio" name="product_option_designer[0][text_color]" value="0" <?php if ($product_option_designer['text_color'] == "0") echo "checked='checked'";?>/>
				                	<?php echo $text_any_color ?>
									<br>
				                	<input type="radio" name="product_option_designer[0][text_color]" value="1" <?php if ($product_option_designer['text_color'] == "1") echo "checked='checked'";?>/>
				                	<?php echo $text_only_added_colors ?>
				              </td>
				            </tr>
                            <?php } ?>
				        </table>
					</div>
				]]>
			</add>
		</operation>
	</file>
    <file name="admin/model/catalog/product.php">
		<operation>
			<search position="before" index="1">
				<![CDATA[if (isset($data['product_layout'])) {]]>
			</search>
			<add>
				<![CDATA[if (isset($data['product_option_designer'])) {
                			foreach ($data['product_option_designer'] as $product_option_designer) {
                				$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_designer SET product_id = '" . (int)$product_id . "', enable = '" . (int)$product_option_designer['enable'] . "', frame_image = '" . $this->db->escape(html_entity_decode($product_option_designer['frame_image'], ENT_QUOTES, 'UTF-8')) . "', allow_adding_text = '" . (int)$product_option_designer['allow_adding_text'] . "', allow_text_effect_border = '" . (int)$product_option_designer['allow_text_effect_border'] . "', allow_text_effect_shadow = '" . (int)$product_option_designer['allow_text_effect_shadow'] . "', allow_text_effect_curve = '" . (int)$product_option_designer['allow_text_effect_curve'] . "', text_color = '" . (int)$product_option_designer['text_color'] . "'");
                			}
                		}
                ]]>
			</add>
		</operation>
        <operation>
			<search position="after">
				<![CDATA[public function editProduct($product_id, $data) {]]>
			</search>
			<add>
				<![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "product_option_designer WHERE product_id = '" . (int)$product_id . "'");
        
                        if (isset($data['product_option_designer'])) {
                			foreach ($data['product_option_designer'] as $product_option_designer) {
                				$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_designer SET product_id = '" . (int)$product_id . "', enable = '" . (int)$product_option_designer['enable'] . "', frame_image = '" . $this->db->escape(html_entity_decode($product_option_designer['frame_image'], ENT_QUOTES, 'UTF-8')) . "', allow_adding_text = '" . (int)$product_option_designer['allow_adding_text'] . "', allow_text_effect_border = '" . (int)$product_option_designer['allow_text_effect_border'] . "', allow_text_effect_shadow = '" . (int)$product_option_designer['allow_text_effect_shadow'] . "', allow_text_effect_curve = '" . (int)$product_option_designer['allow_text_effect_curve'] . "', text_color = '" . (int)$product_option_designer['text_color'] . "'");
                			}
                		}
                ]]>
			</add>
		</operation>      
        <operation>
			<search position="after">
				<![CDATA[$data = array_merge($data, array('product_download' => $this->getProductDownloads($product_id)));]]>
			</search>
			<add>
				<![CDATA[$data = array_merge($data, array('product_option_designer' => $this->getProductOptionDesigner($product_id)));
                ]]>
			</add>
		</operation>  
        <operation>
			<search position="after">
				<![CDATA[public function deleteProduct($product_id) {]]>
			</search>
			<add>
				<![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "product_option_designer WHERE product_id = '" . (int) $product_id . "'");
                ]]>
			</add>
		</operation>
        <operation>
			<search position="before">
				<![CDATA[public function getProductLayouts($product_id) {]]>
			</search>
			<add>
				<![CDATA[public function getProductOptionDesigner($product_id) {
        $product_option_designer_data = array();
		
		$product_option_designers = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_option_designer WHERE product_id = '" . (int)$product_id . "'");
        foreach ($product_option_designers->rows as $product_option_designer) {
            if ($product_option_designer['frame_image'] && file_exists(DIR_IMAGE . $product_option_designer['frame_image'])) {
				$image = $product_option_designer['frame_image'];
			} else {
				$image = 'no_image.jpg';
			}
            $product_option_designer_data[] = array(
    			'frame_image'               => $image,
    			'thumb'                     => $this->model_tool_image->resize($image, 100, 100),
    			'enable'                    => $product_option_designer['enable'],
                'allow_adding_text'         => $product_option_designer['allow_adding_text'],
                'allow_text_effect_border'  => $product_option_designer['allow_text_effect_border'],
                'allow_text_effect_shadow'  => $product_option_designer['allow_text_effect_shadow'],
                'allow_text_effect_curve'   => $product_option_designer['allow_text_effect_curve'],
                'text_color'                => $product_option_designer['text_color']
    		);
        }
        return $product_option_designer_data;
    }
                ]]>
			</add>
		</operation> 
	</file>
	<file name="admin/controller/catalog/product.php">
		<operation>
			<search position="after" index="1">
				<![CDATA[$this->data['tab_design'] = $this->language->get('tab_design');]]>
			</search>
			<add>
				<![CDATA[
					$this->language->load('module/product_designer');
					$this->data['tab_product_designer'] = $this->language->get('tab_product_designer');
					$this->data['text_enable'] = $this->language->get('text_enable');
					$this->data['text_frame_image'] = $this->language->get('text_frame_image');
					$this->data['allow_adding_text'] = $this->language->get('allow_adding_text');
					$this->data['allow_text_effects'] = $this->language->get('allow_text_effects');
					$this->data['text_effects_border'] = $this->language->get('text_effects_border');
					$this->data['text_effects_shadow'] = $this->language->get('text_effects_shadow');
					$this->data['text_effects_curve'] = $this->language->get('text_effects_curve');
					$this->data['text_color'] = $this->language->get('text_color');
					$this->data['text_any_color'] = $this->language->get('text_any_color');
					$this->data['text_only_added_colors'] = $this->language->get('text_only_added_colors');
				]]>
			</add>
		</operation>
		<operation>
			<search position="before">
				<![CDATA[if (isset($this->request->post['product_layout'])) {]]>
			</search>
			<add>
				<![CDATA[if (isset($this->request->post['product_option_designer'])) {
			$product_option_designers = $this->request->post['product_option_designer'];
		} elseif (isset($this->request->get['product_id'])) {
			$product_option_designers = $this->model_catalog_product->getProductOptionDesigner($this->request->get['product_id']);
            if($product_option_designers == null)
            {
                $this->data['product_option_designers'][] = array(
        			'frame_image'               => 'no_image.jpg',
        			'thumb'                     => $this->model_tool_image->resize('no_image.jpg', 100, 100),
        			'enable'                    => 0,
                    'allow_adding_text'         => 0,
                    'allow_text_effect_border'  => 0,
                    'allow_text_effect_shadow'  => 0,
                    'allow_text_effect_curve'   => 0,
                    'text_color'                => 0
        		);
            }
		} else {
            $product_option_designers = array();    
            $this->data['product_option_designers'][] = array(
    			'frame_image'               => 'no_image.jpg',
    			'thumb'                     => $this->model_tool_image->resize('no_image.jpg', 100, 100),
    			'enable'                    => 0,
                'allow_adding_text'         => 0,
                'allow_text_effect_border'  => 0,
                'allow_text_effect_shadow'  => 0,
                'allow_text_effect_curve'   => 0,
                'text_color'                => 0
    		);             
		}
                        
		foreach ($product_option_designers as $product_option_designer) {
			if ($product_option_designer['frame_image'] && file_exists(DIR_IMAGE . $product_option_designer['frame_image'])) {
				$image = $product_option_designer['frame_image'];
			} else {
				$image = 'no_image.jpg';
			}
            $this->data['product_option_designers'][] = array(
				'frame_image'               => $image,
				'thumb'                     => $this->model_tool_image->resize($image, 100, 100),
				'enable'                    => $product_option_designer['enable'],
                'allow_adding_text'         => $product_option_designer['allow_adding_text'],
                'allow_text_effect_border'  => $product_option_designer['allow_text_effect_border'],
                'allow_text_effect_shadow'  => $product_option_designer['allow_text_effect_shadow'],
                'allow_text_effect_curve'   => $product_option_designer['allow_text_effect_curve'],
                'text_color'                => $product_option_designer['text_color']
			);
		}
                ]]>
			</add>
		</operation>
	</file>
	
    <file name="admin/view/template/common/header.tpl">
        <operation>
			<search position="after" index="1">
				<![CDATA[
					<script type="text/javascript" src="view/javascript/common.js"></script>
				]]>
			</search>
			<add>
				<![CDATA[
					<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css">
					<link type="text/css" href="view/javascript/jquery/simplecolorpicker/jquery.simplecolorpicker.css" rel="stylesheet" />
					<link type="text/css" href="view/javascript/jquery/simplecolorpicker/jquery.simplecolorpicker-regularfont.css" rel="stylesheet" />
					<link type="text/css" href="view/javascript/jquery/simplecolorpicker/jquery.simplecolorpicker-glyphicons.css" rel="stylesheet" />
					<link type="text/css" href="view/javascript/jquery/simplecolorpicker/jquery.simplecolorpicker-fontawesome.css" rel="stylesheet" />
					<script type="text/javascript" src="view/javascript/jquery/simplecolorpicker/jquery.simplecolorpicker.js"></script>
				]]>
			</add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/product/product.tpl">
        <operation>
            <search position="before">
                <![CDATA[<div class="options">]]>
            </search>
            <add>
                <![CDATA[
                    <div class="product_designer gteie9">
                    	<a href="javascript:void(0)" onclick="openPopupProductDesigner();" id="product_designer_iframe">
                    		<input type="button" value="Design your own Iphone"  class="button">
                    	</a>
                    </div>]]>
			</add>
		</operation>
	</file>
    <file name="catalog/model/catalog/product.php">
		<operation>
			<search position="before" index="1">
				<![CDATA[public function getProductLayoutId($product_id) {]]>
			</search>
			<add>
				<![CDATA[public function getProductOptionDesigner($product_id) {
        $product_option_designer_data = array();
		
		$product_option_designers = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_option_designer WHERE product_id = '" . (int)$product_id . "'");
        foreach ($product_option_designers->rows as $product_option_designer) {
            if ($product_option_designer['frame_image'] && file_exists(DIR_IMAGE . $product_option_designer['frame_image'])) {
				$image = $product_option_designer['frame_image'];
			} else {
				$image = 'no_image.jpg';
			}
            $product_option_designer_data[] = array(
    			'frame_image'               => $image,
    			'thumb'                     => $this->model_tool_image->resize($image, 100, 100),
    			'enable'                    => $product_option_designer['enable'],
                'allow_adding_text'         => $product_option_designer['allow_adding_text'],
                'allow_text_effect_border'  => $product_option_designer['allow_text_effect_border'],
                'allow_text_effect_shadow'  => $product_option_designer['allow_text_effect_shadow'],
                'allow_text_effect_curve'   => $product_option_designer['allow_text_effect_curve'],
                'text_color'                => $product_option_designer['text_color']
    		);
        }
        return $product_option_designer_data;
    }
                ]]>
			</add>
		</operation>
    </file>
    <file name="catalog/controller/catalog/product.php">
		<operation>
			<search position="before" index="1">
				<![CDATA[$this->data['options'] = array();]]>
			</search>
			<add>
				<![CDATA[$product_option_designers = $this->model_catalog_product->getProductOptionDesigner($this->request->get['product_id']);
            
            $this->data['product_option_designers'] = array();   
                            
    		foreach ($product_option_designers as $product_option_designer) {
    			if ($product_option_designer['frame_image'] && file_exists(DIR_IMAGE . $product_option_designer['frame_image'])) {
    				$image = $product_option_designer['frame_image'];
    			} else {
    				$image = 'no_image.jpg';
    			}
                $this->data['product_option_designers'][] = array(
    				'frame_image'               => $image,
    				'thumb'                     => $this->model_tool_image->resize($image, 100, 100),
    				'enable'                    => $product_option_designer['enable'],
                    'allow_adding_text'         => $product_option_designer['allow_adding_text'],
                    'allow_text_effect_border'  => $product_option_designer['allow_text_effect_border'],
                    'allow_text_effect_shadow'  => $product_option_designer['allow_text_effect_shadow'],
                    'allow_text_effect_curve'   => $product_option_designer['allow_text_effect_curve'],
                    'text_color'                => $product_option_designer['text_color']
    			);
    		}
                ]]>
			</add>
		</operation>
    </file>
</modification>